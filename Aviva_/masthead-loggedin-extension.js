"use strict";define(["jquery","app/util/cookie"],function(n,i){function t(t,e){this.$el=t,this.defaults={selectors:{body:"body",forename:".o-masthead-logged-in-title__name, .o-masthead-logged-in-link__name",loginLink:".o-masthead__login-link",loggedInTemplate:".logged-in-template",loggedInLink:".o-masthead-logged-in-link",logInContainer:".o-masthead-login",loggedInContainer:".o-masthead-logged-in",masthead:".o-masthead"},attributes:{cookie:"masthead-loggedin-cookie",applicableto:"data-applicableto"},dataEndpoint:this.$el.data("endpoint")},this.settings=n.extend({},this.defaults,e),this.$loginLink=n(this.settings.selectors.loginLink),this.$loggedInLink=n(this.settings.selectors.loggedInLink),this.$loggedInTemplate=n(this.settings.selectors.loggedInTemplate),this.$logInContainer=n(this.settings.selectors.logInContainer),this.$loggedInContainer=n(this.settings.selectors.loggedInContainer),this.$masthead=n(this.settings.selectors.masthead),this.cookie=this.$el.data(this.settings.attributes.cookie),this.cookieUtil=i()}return t.prototype={init:function(){this.doesCookieExist()?this.getUserInfo():(this.moduleScan(),this.$loggedInContainer.hide())},doesCookieExist:function(){return null!==this.cookieUtil.getCookie(this.cookie)},getUserInfo:function(){var e=this;n.ajax({url:this.settings.dataEndpoint,xhrFields:{withCredentials:!0},method:"get"}).done(function(t){e.renderDropDown(t)}).fail(function(){e.moduleScan(),e.$loggedInContainer.hide()})},renderDropDown:function(t){this.$loginLink.hide(),this.$logInContainer.remove(),this.$loginLink.after(this.$loggedInTemplate.html()),this.moduleScan(),t.classifications&&this.getClassifications(t.classifications),this.$forename=document.querySelectorAll(this.settings.selectors.forename),this.addUserNameToDropDown(t.forename),this.$loggedInTemplate.remove()},addUserNameToDropDown:function(e){this.$forename.forEach(function(t){t.appendChild(document.createTextNode(e))})},moduleScan:function(){this.$masthead.attr("data-module","o-masthead"),n(this.settings.selectors.body).trigger("moduleScan")},getClassifications:function(t){var o=this.settings.attributes;this.$loggedInLink.parent().hide(),n(this.settings.selectors.loggedInLink).each(function(){var e=n(this),i=e.attr(o.applicableto).toLowerCase();t.forEach(function(t){(0<=i.indexOf(t.toLowerCase())||0<=i.indexOf("all"))&&e.parent().show()})})}},t});